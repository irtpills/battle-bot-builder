<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle Bot Builder - Bigfoot Country</title>
    <meta name="description" content="Build attack sequences for Bigfoot Country battle bot - Generate Python code with GUI">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öîÔ∏è</text></svg>">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        
        // Lucide icons as inline SVG components
        const Search = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Trash2 = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const Plus = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Copy = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;
        const Check = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const ChevronDown = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>;
        const ChevronRight = (props) => <svg {...props} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>;

function BattleBotBuilder() {
  const [units, setUnits] = useState([]);
  const [attacks, setAttacks] = useState([]);
  const [copied, setCopied] = useState(false);
  const [expandedAttacks, setExpandedAttacks] = useState(new Set());
  const [openUnitDropdown, setOpenUnitDropdown] = useState(null);
  const [unitSearchTerms, setUnitSearchTerms] = useState({});

  // Available units (complete list from unit_order.py)
  const allUnitTypes = [
    "Unit_Snake.png",
    "Unit_Pelican.png",
    "Unit_Buoy.png",
    "Unit_Jet_Ski.png",
    "Unit_Power_Boat.png",
    "Units/Unit_Arctic_Trooper.png",
    "Unit_Arsonist.png",
    "Unit_Bazooka.png",
    "Unit_Mauler.png",
    "Unit_Young_Boar.png",
    "Unit_Peacemonger.png",
    "Unit_Chem_Trooper.png",
    "Unit_Commando.png",
    "Unit_Peace_Keeper.png",
    "Unit_Demolitionist.png",
    "Unit_Imperial_Dragoon.png",
    "Unit_Flame_Trooper.png",
    "Unit_Salamander.png",
    "Unit_Grenadier.png",
    "Unit_Chem_Grenadier.png",
    "Unit_Gunner.png",
    "Unit_Hitman.png",
    "Unit_Hunter.png",
    "Unit_Juggernaut.png",
    "Unit_Young_Mammoth.png",
    "Unit_Armadillo.png",
    "Unit_Field_Agent.png",
    "Unit_Hvy_Gunner.png",
    "Unit_Mortar.png",
    "Unit_Turtlesheller.png",
    "Unit_Ninja.png",
    "Unit_Junior_Officer.png",
    "Unit_Raider_Champ.png",
    "Unit_Skirmisher.png",
    "Unit_Ranger.png",
    "Unit_Raptor.png",
    "Unit_Young_Raptor.png",
    "Unit_Hornet.png",
    "Unit_RPG_Troop.png",
    "Unit_Saboteur.png",
    "Unit_Sandbags.png",
    "Unit_Tamed_Sandworm.png",
    "Unit_Young_Worm.png",
    "Unit_Shock_Trooper.png",
    "Unit_Riot_Trooper.png",
    "Unit_Sharp_Shooter.png",
    "Unit_Sniper.png",
    "Unit_Marksman.png",
    "Unit_Trouper.png",
    "Unit_Cryo_Trooper.png",
    "Unit_Lightning_Dragoon.png",
    "Units/Unit_Elemental_Trooper.png",
    "Unit_Lightning_Trooper.png",
    "Unit_Wimp.png",
    "Unit_Veteran.png",
    "Unit_Arch_Bullfrog.png",
    "Unit_Colossus.png",
    "Unit_Portable_Wall.png",
    "Unit_Garbage_Truck.png",
    "Unit_Baby_Grouper.png",
    "Unit_Grouper.png",
    "Unit_Battleship_R1.png",
    "Unit_Battleship_M10.png",
    "Unit_Destroyer.png",
    "Unit_Gunboat.png",
    "Unit_Ironclad.png",
    "Unit_Sub.png",
    "Unit_Demoman.png",
    "Unit_Heavy.png",
    "Unit_Scout.png",
    "Unit_Soldier.png",
    "Unit_Dune_Rider.png",
    "Unit_Dexter.png",
    "Unit_Light_Artillery.png",
    "Unit_Scout_Bike.png",
    "Unit_Brutalizer.png",
    "Unit_Gun_Truck.png",
    "Unit_Unmanned_Machine_Gun.png",
    "Unit_Tempest.png",
    "Unit_Chucker.png",
    "Unit_Recon.png",
    "Unit_Riot_Truck.png",
    "Unit_Basilisk.png",
    "Unit_Heavy_Chem_Tank.png",
    "Unit_Light_Chem_Tank.png",
    "Unit_Frostbite.png",
    "Unit_Dragon.png",
    "Unit_Heavier_Tank.png",
    "Unit_Heavy_Tank.png",
    "Unit_Light_Tank.png",
    "Unit_Mega_Tank.png",
    "Unit_Mini_Tank.png",
    "Unit_Super_Tank.png",
    "Unit_Lightning_Tank.png",
    "Unit_Tank_Killer.png",
    "Units/Unit_Trebuchet.png",
  ];

  // Battle positions (5 front, 5 middle, 3 back)
  const positions = [
    'front_one', 'front_two', 'front_three', 'front_four', 'front_five',
    'middle_one', 'middle_two', 'middle_three', 'middle_four', 'middle_five',
    'back_one', 'back_two', 'back_three'
  ];

  // Attack types
  const attackTypes = [
    { id: 'attack_first_enemy', label: 'Attack First Enemy (L‚ÜíR)', params: [] },
    { id: 'battle_click', label: 'Battle Click (Specific Spot)', params: ['enemy_position'] },
    { id: 'aircraft_drag', label: 'Aircraft Drag to Attack', params: ['enemy_position'] },
    { id: 'click_random_row', label: 'Click Random Enemy Row', params: ['row'] },
    { id: 'smart_attack', label: 'Smart Attack (Veteran)', params: ['fallback'] },
  ];

  const enemyPositions = [
    'front_one', 'front_two', 'front_three', 'front_four', 'front_five',
    'middle_one', 'middle_two', 'middle_three', 'middle_four', 'middle_five',
    'back_one', 'back_two', 'back_three'
  ];

  const rows = ['front', 'middle', 'back'];

  // Fallback attack options (all attacks except smart_attack)
  const fallbackAttacks = [
    { id: 'attack_first_enemy_left_to_right()', label: 'Attack First Enemy (L‚ÜíR)' },
    { id: 'battle_click_enemy("front_one")', label: 'Battle Click Enemy' },
    { id: 'aircraft_drag_to_attack("front_one")', label: 'Aircraft Drag to Attack' },
    { id: 'click_random_enemy_row("front")', label: 'Click Random Enemy Row' },
  ];

  // Add unit
  const addUnit = () => {
    const newId = Date.now();
    const defaultUnit = allUnitTypes[0];
    setUnits([...units, {
      id: newId,
      type: defaultUnit,
      quantity: 1,
      drags: [] // Array of {from: 'front_one', to: 'middle_two'}
    }]);
    setUnitSearchTerms({
      ...unitSearchTerms,
      [newId]: defaultUnit.replace('Unit_', '').replace('.png', '').replace(/_/g, ' ')
    });
  };

  // Remove unit
  const removeUnit = (id) => {
    setUnits(units.filter(u => u.id !== id));
    const newSearchTerms = {...unitSearchTerms};
    delete newSearchTerms[id];
    setUnitSearchTerms(newSearchTerms);
  };

  // Update unit
  const updateUnit = (id, field, value) => {
    setUnits(units.map(u => u.id === id ? { ...u, [field]: value } : u));
  };

  // Add drag operation to unit
  const addDrag = (unitId) => {
    setUnits(units.map(u => 
      u.id === unitId 
        ? { ...u, drags: [...u.drags, { id: Date.now(), from: positions[0], to: positions[1] }] }
        : u
    ));
  };

  // Remove drag operation
  const removeDrag = (unitId, dragId) => {
    setUnits(units.map(u =>
      u.id === unitId
        ? { ...u, drags: u.drags.filter(d => d.id !== dragId) }
        : u
    ));
  };

  // Update drag operation
  const updateDrag = (unitId, dragId, field, value) => {
    setUnits(units.map(u =>
      u.id === unitId
        ? { ...u, drags: u.drags.map(d => d.id === dragId ? { ...d, [field]: value } : d) }
        : u
    ));
  };

  // Add attack
  const addAttack = () => {
    const newAttack = {
      id: Date.now(),
      position: positions[0],
      attackType: attackTypes[0].id,
      enemyPosition: enemyPositions[0],
      row: rows[0],
      fallback: fallbackAttacks[0].id,
      delay: 0.1
    };
    setAttacks([...attacks, newAttack]);
    setExpandedAttacks(new Set([...expandedAttacks, newAttack.id]));
  };

  // Remove attack
  const removeAttack = (id) => {
    setAttacks(attacks.filter(a => a.id !== id));
    const newExpanded = new Set(expandedAttacks);
    newExpanded.delete(id);
    setExpandedAttacks(newExpanded);
  };

  // Update attack
  const updateAttack = (id, field, value) => {
    setAttacks(attacks.map(a => a.id === id ? { ...a, [field]: value } : a));
  };

  // Move attack up/down
  const moveAttack = (index, direction) => {
    const newAttacks = [...attacks];
    const newIndex = index + direction;
    if (newIndex >= 0 && newIndex < attacks.length) {
      [newAttacks[index], newAttacks[newIndex]] = [newAttacks[newIndex], newAttacks[index]];
      setAttacks(newAttacks);
    }
  };

  // Toggle attack expansion
  const toggleAttack = (id) => {
    const newExpanded = new Set(expandedAttacks);
    if (newExpanded.has(id)) {
      newExpanded.delete(id);
    } else {
      newExpanded.add(id);
    }
    setExpandedAttacks(newExpanded);
  };

  // Get attack summary
  const getAttackSummary = (attack) => {
    const attackType = attackTypes.find(t => t.id === attack.attackType);
    return `${attack.position} ‚Üí ${attackType?.label || attack.attackType}`;
  };

  // Generate Python code
  const generateCode = () => {
    let code = '';
    
    // ========== PART 1: UNIT SELECTION FUNCTION ==========
    code += 'def select_battle_units():\n';
    code += '    """\n';
    code += '    Select the units for battle using improved scrolling.\n';
    code += '    This replaces the old unit selection section.\n';
    code += '    """\n';
    code += '    print("üî• Selecting battle units...")\n';
    code += '    \n';
    code += '    # Move mouse to center of unit bar first\n';
    code += '    bar_center_x = 10 + 1890 // 2\n';
    code += '    bar_center_y = 900 + 100 // 2\n';
    code += '    pyautogui.moveTo(bar_center_x, bar_center_y, duration=0.2)\n';
    code += '\n';

    if (units.length > 0) {
      units.forEach(unit => {
        const unitName = unit.type.replace('Unit_', '').replace('.png', '').replace(/_/g, ' ');
        code += `    # Select ${unit.quantity} ${unitName}${unit.quantity > 1 ? 's' : ''}\n`;
        code += `    for i in range(${unit.quantity}):\n`;
        code += '        combined_check()\n';
        code += `        if not smart_scroll_to_unit("Units/${unit.type}"):\n`;
        code += `            print(f"‚ö†Ô∏è Could not select ${unitName} {i+1}")\n`;
        code += '            return False\n';
        code += '\n';

        // Add drag operations if any
        if (unit.drags && unit.drags.length > 0) {
          unit.drags.forEach(drag => {
            code += `    # Drag unit from ${drag.from} to ${drag.to}\n`;
            code += `    drag_unit_to_position("${drag.from}", "${drag.to}")\n`;
            code += '\n';
          });
        }
      });
    } else {
      code += '    # No units configured - add units in the builder!\n';
      code += '    pass\n';
      code += '\n';
    }

    code += '    print("‚úÖ All units selected successfully!")\n';
    code += '    return True\n\n';
    code += '# ========== END OF IMPROVED SCROLL FUNCTIONS ==========\n\n';

    // ========== PART 2: START BATTLE LOOP ==========
    code += 'def start_battle_loop(discord_client):\n';
    code += '    print("Starting in 3 seconds... Press F2 to pause, F3 to exit.")\n';
    code += '    combined_check()\n';
    code += '    time.sleep(3)\n';
    code += '\n';
    code += '    total_loops = 0\n';
    code += '    loop_start_time = time.time()\n';
    code += '\n';
    code += '    channel = discord_client.get_channel(1403521501587705956)\n';
    code += '    if not channel:\n';
    code += '        print("‚ùå Discord channel not found.")\n';
    code += '\n';
    code += '    try:\n';
    code += '\n';
    code += '        # === 1. Start battle ===\n';
    code += '        combined_check()\n';
    code += '        if not click_image("attack_button_bigfoot.png", region=(1750, 850, 200, 200)):\n';
    code += '            print("Attack button not found. Ending battle early.")\n';
    code += '            raise ExitRequested()\n';
    code += '\n';
    code += '        combined_check()\n';
    code += '        if not click_image("check_mark.png", region=(390, 250, 1000, 500)):\n';
    code += '            print("Check mark not found. Ending battle early.")\n';
    code += '            raise ExitRequested()\n';
    code += '\n';
    code += '        smart_sleep(random.uniform(5.5, 6.5))\n';
    code += '\n';
    code += '        # === 2.a. Select Front Line Units ===\n';
    code += '        if not select_battle_units():\n';
    code += '            print("Failed to select units. Ending battle early.")\n';
    code += '            raise ExitRequested()\n';
    code += '\n';
    code += '        for i in range(500):\n';
    code += '            if stop_event.is_set():\n';
    code += '                print("üõë Exit requested. Stopping battle loop.")\n';
    code += '                break\n';
    code += '            start_time = time.time()\n';
    code += '            combined_check()\n';
    code += '\n';
    code += '            # === 3. Start Fight ===\n';
    code += '            combined_check()\n';
    code += '            if not click_image("fight_button.png", region=(1600, 440, 328, 460)):\n';
    code += '                print("Fight button not found!")\n';
    code += '                break\n';
    code += '\n';
    code += '            # === 4. Attack Sequence ===\n';
    code += '            battle_ended = False\n';
    code += '            combined_check()\n';
    code += '\n';
    code += '            if should_take_break():\n';
    code += '                take_natural_break()\n';
    code += '            \n';
    code += '            veteran_unit.reset_veteran()\n';
    code += '\n';

    // Generate attacks
    if (attacks.length > 0) {
      attacks.forEach((attack, index) => {
        code += `            # Attack ${index + 1}\n`;
        code += '            if not battle_ended:\n';
        code += '                combined_check()\n';
        code += '                # detect_enemy_row_shift()\n';
        code += `                click_unit_position("${attack.position}", delay=${attack.delay})\n`;
        
        // Generate attack call based on type
        switch(attack.attackType) {
          case 'attack_first_enemy':
            code += '                attack_first_enemy_left_to_right()\n';
            break;
          case 'battle_click':
            code += `                battle_click_enemy("${attack.enemyPosition}")\n`;
            break;
          case 'aircraft_drag':
            code += `                aircraft_drag_to_attack("${attack.enemyPosition}")\n`;
            break;
          case 'click_random_row':
            code += `                click_random_enemy_row("${attack.row}")\n`;
            break;
          case 'smart_attack':
            code += `                if not smart_attack("veteran", "${attack.position}", 2):\n`;
            code += `                    ${attack.fallback}\n`;
            break;
        }
        
        code += '                time.sleep(3)\n';
        code += '                if check_victory_and_click(discord_client=discord_client, channel=channel, loop_number=i+1, first_loop=(i==0)):\n';
        code += '                    battle_ended = True\n';
        code += '                else:\n';
        code += `                    wait_for_unit_ready("${attack.position}")\n`;
        code += '                    veteran_unit.tick_turn()\n';
        code += '\n';
      });
    } else {
      code += '            # No attacks configured - add attacks in the builder!\n';
      code += '            pass\n';
      code += '\n';
    }

    return code;
  };

  // Copy to clipboard
  const copyCode = () => {
    const code = generateCode();
    navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-5xl font-bold text-white mb-3">
            ‚öîÔ∏è Battle Bot Builder
          </h1>
          <p className="text-purple-300 text-lg">
            Design your attack sequence with a GUI, export complete Python code
          </p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {/* Left Column - Unit & Attack Builder */}
          <div className="space-y-6">
            {/* Unit Selection */}
            <div className="bg-slate-800 rounded-lg p-6 shadow-xl border border-purple-500/30">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-2xl font-bold text-white">Unit Selection</h2>
                <button
                  onClick={addUnit}
                  className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors"
                >
                  <Plus size={20} />
                  Add Unit
                </button>
              </div>

              <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
                {units.length === 0 && (
                  <p className="text-gray-400 text-center py-8">No units added yet. Click "Add Unit" to start.</p>
                )}
                {units.map(unit => (
                  <div key={unit.id} className="bg-slate-700 rounded p-4 space-y-3">
                    <div className="grid grid-cols-2 gap-3">
                      <div className="col-span-2 relative">
                        <label className="text-sm text-gray-300 block mb-1">
                          <Search size={14} className="inline mr-1" />
                          Unit Type
                        </label>
                        <div className="relative">
                          <input
                            type="text"
                            value={unitSearchTerms[unit.id] || unit.type.replace('Unit_', '').replace('.png', '').replace(/_/g, ' ')}
                            onChange={(e) => {
                              setUnitSearchTerms({...unitSearchTerms, [unit.id]: e.target.value});
                              setOpenUnitDropdown(unit.id);
                            }}
                            onFocus={() => setOpenUnitDropdown(unit.id)}
                            className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500"
                            placeholder="Type to search..."
                          />
                          
                          {/* Dropdown */}
                          {openUnitDropdown === unit.id && (
                            <>
                              <div 
                                className="fixed inset-0 z-10" 
                                onClick={() => setOpenUnitDropdown(null)}
                              />
                              <div className="absolute z-20 w-full mt-1 bg-slate-600 border border-slate-500 rounded max-h-48 overflow-y-auto shadow-lg">
                                {allUnitTypes
                                  .filter(type => {
                                    const searchTerm = unitSearchTerms[unit.id] || '';
                                    return type.toLowerCase().includes(searchTerm.toLowerCase());
                                  })
                                  .map(type => (
                                    <div
                                      key={type}
                                      onClick={() => {
                                        updateUnit(unit.id, 'type', type);
                                        setUnitSearchTerms({...unitSearchTerms, [unit.id]: type.replace('Unit_', '').replace('.png', '').replace(/_/g, ' ')});
                                        setOpenUnitDropdown(null);
                                      }}
                                      className="px-3 py-2 hover:bg-slate-700 cursor-pointer text-white text-sm"
                                    >
                                      {type.replace('Unit_', '').replace('.png', '').replace(/_/g, ' ')}
                                    </div>
                                  ))}
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                      <div>
                        <label className="text-sm text-gray-300 block mb-1">Quantity</label>
                        <input
                          type="number"
                          min="1"
                          max="10"
                          value={unit.quantity}
                          onChange={(e) => updateUnit(unit.id, 'quantity', parseInt(e.target.value))}
                          className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500"
                        />
                      </div>
                      <div className="flex items-end">
                        <button
                          onClick={() => addDrag(unit.id)}
                          className="w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm transition-colors"
                        >
                          + Add Drag
                        </button>
                      </div>
                    </div>

                    {/* Drag operations */}
                    {unit.drags && unit.drags.length > 0 && (
                      <div className="space-y-2 pl-4 border-l-2 border-blue-500">
                        {unit.drags.map(drag => (
                          <div key={drag.id} className="grid grid-cols-3 gap-2 bg-slate-600 p-2 rounded">
                            <div>
                              <label className="text-xs text-gray-400 block">From</label>
                              <select
                                value={drag.from}
                                onChange={(e) => updateDrag(unit.id, drag.id, 'from', e.target.value)}
                                className="w-full bg-slate-700 text-white px-2 py-1 rounded text-xs"
                              >
                                {positions.map(pos => (
                                  <option key={pos} value={pos}>{pos}</option>
                                ))}
                              </select>
                            </div>
                            <div>
                              <label className="text-xs text-gray-400 block">To</label>
                              <select
                                value={drag.to}
                                onChange={(e) => updateDrag(unit.id, drag.id, 'to', e.target.value)}
                                className="w-full bg-slate-700 text-white px-2 py-1 rounded text-xs"
                              >
                                {positions.map(pos => (
                                  <option key={pos} value={pos}>{pos}</option>
                                ))}
                              </select>
                            </div>
                            <div className="flex items-end">
                              <button
                                onClick={() => removeDrag(unit.id, drag.id)}
                                className="text-red-400 hover:text-red-300 text-xs"
                              >
                                <Trash2 size={14} />
                              </button>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}

                    <button
                      onClick={() => removeUnit(unit.id)}
                      className="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm transition-colors"
                    >
                      <Trash2 size={16} />
                      Remove Unit
                    </button>
                  </div>
                ))}
              </div>
            </div>

            {/* Attack Sequence */}
            <div className="bg-slate-800 rounded-lg p-6 shadow-xl border border-purple-500/30">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-2xl font-bold text-white">Attack Sequence ({attacks.length})</h2>
                <button
                  onClick={addAttack}
                  className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors"
                >
                  <Plus size={20} />
                  Add Attack
                </button>
              </div>

              <div className="space-y-2 max-h-96 overflow-y-auto pr-2">
                {attacks.length === 0 && (
                  <p className="text-gray-400 text-center py-8">No attacks added yet. Click "Add Attack" to start.</p>
                )}
                {attacks.map((attack, index) => {
                  const isExpanded = expandedAttacks.has(attack.id);
                  const attackTypeInfo = attackTypes.find(t => t.id === attack.attackType);
                  
                  return (
                    <div key={attack.id} className="bg-slate-700 rounded">
                      {/* Attack Header - Always Visible */}
                      <div 
                        className="p-3 cursor-pointer hover:bg-slate-600 transition-colors flex items-center justify-between"
                        onClick={() => toggleAttack(attack.id)}
                      >
                        <div className="flex items-center gap-3 flex-1">
                          {isExpanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}
                          <span className="font-semibold text-white">Attack #{index + 1}</span>
                          <span className="text-gray-300 text-sm">{getAttackSummary(attack)}</span>
                        </div>
                        <div className="flex gap-2">
                          <button
                            onClick={(e) => { e.stopPropagation(); moveAttack(index, -1); }}
                            disabled={index === 0}
                            className="text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed px-2"
                          >
                            ‚Üë
                          </button>
                          <button
                            onClick={(e) => { e.stopPropagation(); moveAttack(index, 1); }}
                            disabled={index === attacks.length - 1}
                            className="text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed px-2"
                          >
                            ‚Üì
                          </button>
                        </div>
                      </div>

                      {/* Attack Details - Collapsible */}
                      {isExpanded && (
                        <div className="p-4 pt-0 space-y-3 border-t border-slate-600">
                          <div className="grid grid-cols-2 gap-3">
                            <div>
                              <label className="text-sm text-gray-300 block mb-1">Your Position</label>
                              <select
                                value={attack.position}
                                onChange={(e) => updateAttack(attack.id, 'position', e.target.value)}
                                className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                              >
                                {positions.map(pos => (
                                  <option key={pos} value={pos}>{pos}</option>
                                ))}
                              </select>
                            </div>
                            <div>
                              <label className="text-sm text-gray-300 block mb-1">Delay (sec)</label>
                              <input
                                type="number"
                                step="0.1"
                                value={attack.delay}
                                onChange={(e) => updateAttack(attack.id, 'delay', parseFloat(e.target.value))}
                                className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                              />
                            </div>
                          </div>

                          <div>
                            <label className="text-sm text-gray-300 block mb-1">Attack Type</label>
                            <select
                              value={attack.attackType}
                              onChange={(e) => updateAttack(attack.id, 'attackType', e.target.value)}
                              className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                            >
                              {attackTypes.map(type => (
                                <option key={type.id} value={type.id}>{type.label}</option>
                              ))}
                            </select>
                          </div>

                          {/* Conditional parameters based on attack type */}
                          {attackTypeInfo?.params.includes('enemy_position') && (
                            <div>
                              <label className="text-sm text-gray-300 block mb-1">Target Enemy</label>
                              <select
                                value={attack.enemyPosition}
                                onChange={(e) => updateAttack(attack.id, 'enemyPosition', e.target.value)}
                                className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                              >
                                {enemyPositions.map(pos => (
                                  <option key={pos} value={pos}>{pos}</option>
                                ))}
                              </select>
                            </div>
                          )}

                          {attackTypeInfo?.params.includes('row') && (
                            <div>
                              <label className="text-sm text-gray-300 block mb-1">Enemy Row</label>
                              <select
                                value={attack.row}
                                onChange={(e) => updateAttack(attack.id, 'row', e.target.value)}
                                className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                              >
                                {rows.map(row => (
                                  <option key={row} value={row}>{row}</option>
                                ))}
                              </select>
                            </div>
                          )}

                          {attackTypeInfo?.params.includes('fallback') && (
                            <div>
                              <label className="text-sm text-gray-300 block mb-1">Fallback Attack</label>
                              <select
                                value={attack.fallback}
                                onChange={(e) => updateAttack(attack.id, 'fallback', e.target.value)}
                                className="w-full bg-slate-600 text-white px-3 py-2 rounded border border-slate-500 text-sm"
                              >
                                {fallbackAttacks.map(fb => (
                                  <option key={fb.id} value={fb.id}>{fb.label}</option>
                                ))}
                              </select>
                            </div>
                          )}

                          <button
                            onClick={() => removeAttack(attack.id)}
                            className="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm transition-colors"
                          >
                            <Trash2 size={16} />
                            Remove Attack
                          </button>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Right Column - Code Preview */}
          <div className="lg:sticky lg:top-8 h-fit">
            <div className="bg-slate-800 rounded-lg p-6 shadow-xl border border-purple-500/30">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-2xl font-bold text-white">Complete Code</h2>
                <button
                  onClick={copyCode}
                  className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors"
                >
                  {copied ? <Check size={20} /> : <Copy size={20} />}
                  {copied ? 'Copied!' : 'Copy All'}
                </button>
              </div>

              <pre className="bg-slate-900 text-green-400 p-4 rounded overflow-x-auto text-xs font-mono max-h-[calc(100vh-12rem)] overflow-y-auto">
                {generateCode()}
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BattleBotBuilder />);
    </script>
</body>
</html>
